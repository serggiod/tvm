angular.module('application').factory('AuthenticationFac',function($http,$location,AlertsFac,SessionSvc,SessionFac){
    return {
        login:function($scope){
            SessionSvc.m='login';
            $http.post('mdl/login.php',SessionSvc)
            .success(function(rta){
                if(rta==='true'){
                    AlertsFac.loginSuccess($scope);
                    SessionSvc.m='userdata';
                    $http.post('mdl/login.php',SessionSvc)
                    .success(function(json){
                        SessionSvc.id=json.id;
                        SessionSvc.nombre=json.nombre;
                        SessionSvc.estado=true;
                        SessionSvc.user=null;
                        SessionSvc.pass=null;
                        SessionSvc.m=null;
                        $location.path('/tv');
                    });
                } else {
                    AlertsFac.loginDanger($scope);
                }
            });
        },
        logout:function(){
            SessionFac.sessionDestroy
        }
    }
});